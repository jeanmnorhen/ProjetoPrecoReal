Vou descrever em detalhes os fluxos do usuário no aplicativo "PREÇO REAL", separando por tipo de usuário: Consumidor, Lojista e Administrador.


1. Fluxo do Consumidor (Usuário comprador)

O consumidor é o usuário principal que busca ofertas e informações sobre produtos.
Visualização de Ofertas em feeds:
As ofertas são carregadas e exibidas em formato de cartões (OfferCard), mostrando nome do produto, imagem, preço, nome da loja e distância. Em dois “feed infinitos” horizontais, o primeiro de cima para baixo deve ser exclusivo para Anúncios do tipo Promoções e Promoções relâmpago. Enquanto o segundo “feed infinito” deve conter anúncios de ofertas. Todos os anúncios têm prazo de validade.
Busca Textual:
O usuário digita termos na barra de busca (Input com ícone Search).
As ofertas exibidas são filtradas em tempo real para corresponder ao nome do produto, nome da loja ou categoria.
Filtragem por Categoria:
Abaixo da pesquisa fica disposto uma série de botões referentes aos filtros das categorias dos produtos dos anúncios no resultados da pesquisa. Ao acionar um desses botões as ofertas do feed são filtradas para mostrar apenas aquelas pertencentes à categoria selecionada.
Ordenação:
O usuário pode escolher ordenar as ofertas por "Proximidade" ou "Preço" (ascendente/descendente) usando um Select.
Busca de Produtos por Análise de Imagem com IA
Acesso à Ferramenta: O usuário no botão com ícone de câmera na barra de navegação interior.
Envio de Imagem: Upload: O usuário clica para selecionar um arquivo de imagem do seu dispositivo. Câmera: O usuário pode optar por abrir a câmera do dispositivo, tirar uma foto. Uma pré-visualização da imagem selecionada/capturada é exibida.
O usuário clica em "Analisar Imagem" ou fotografar novamente.
Resultados da Análise: Produto Identificado: Se o Agente de IA (utilizando `google-generativeai` no `servico-agentes-ia`) identifica o produto, o nome do produto é exibido para confirmação e, se confirmado, exibe o resultado da busca nos feeds de ofertas/promoções. A comunicação com o Agente de IA ocorre via eventos Kafka (`tarefas_ia` para solicitação, `resultados_ia` para resposta).
Verificação e Sugestão para Catálogo: Se a busca por imagem não retorna ofertas para um termo específico, e esse termo não corresponde a um produto no catálogo canônico, o sistema automaticamente sugere esse termo para adição ao catálogo. 
O usuário recebe um Alerta informando sobre essa sugestão.
Produto Não Identificado: Se o Agente de IA não consegue identificar o produto, uma mensagem "Produto não identificado" é exibida. Erro na Análise: Se ocorrer um erro, uma mensagem de falha é mostrada.
Acesso
Se o usuário não estiver logado, ele é solicitado a fazer login/cadastro. Onde sua geolocalização é exigida e vinculada ao usuário.
Criticar dados de produtos (descrição, foto, etc.):
Em uma oferta, o usuário pode clicar em um botão "Reportar problema".
Um formulário simples permite que o usuário selecione o tipo de problema (ex: "Foto incorreta", "Descrição errada") e adicione um breve comentário.
A crítica é enviada para o painel do administrador para revisão.


2. Fluxo do Lojista  (Usuário vendedor)

O lojista pode gerenciar múltiplas lojas ou filiais a partir de uma única conta.

Cadastro e Login (Idêntico ao consumidor para autenticação inicial).

Seleção de Loja:
Após o login, se o lojista gerencia mais de uma loja, ele é direcionado para uma tela de seleção. Nessa tela, ele pode escolher qual loja deseja administrar na sessão atual ou optar por adicionar uma nova loja.
Se o lojista gerencia apenas uma loja, ele é levado diretamente para o painel de controle dessa loja.

Painel de Controle (Contextual à Loja Selecionada):
O lojista gerencia os dados de perfil, a vitrine virtual e os anúncios ativos. Todas as ações subsequentes são realizadas no contexto da loja selecionada.

Gerenciamento de Loja:
O lojista pode adicionar novas lojas/filiais ou editar as informações de uma loja existente (nome, endereço, contatos, etc.) a partir da tela de seleção de loja.

Gerenciamento de Funcionários (Contextual à Loja Selecionada):
No seu painel, o lojista acessa a seção "Funcionários".
Adicionar Funcionário: O lojista busca por um usuário existente para designá-lo como funcionário **para a loja atualmente selecionada**.
Definir Turnos: Ao adicionar, o lojista define os turnos de trabalho do funcionário para aquele vínculo específico.
Gerenciar: O lojista pode visualizar e gerenciar a lista de funcionários da loja selecionada.


3. Fluxo do Funcionário

O funcionário é um usuário comum que foi designado por um lojista para uma ou mais lojas.

Login: O funcionário faz login normalmente.

Seleção de Loja (se aplicável):
Se o funcionário trabalha em mais de uma loja, ele é solicitado a escolher para qual loja deseja registrar atividades.

Painel de Controle Condicional:
O aplicativo identifica o vínculo do funcionário com a loja selecionada.
O sistema realiza uma verificação contínua:
1.  **Verificação de Geolocalização:** Confere se a localização do dispositivo está dentro do perímetro da loja selecionada.
2.  **Verificação de Horário:** Confere se o horário atual corresponde a um dos turnos de trabalho para aquele vínculo.

Acesso Permitido:
Se as condições forem verdadeiras, o funcionário acessa um painel para gerenciar **Produtos** e **Ofertas** da loja selecionada.

Acesso Negado:
Se as condições forem falsas, as funcionalidades de gerenciamento são desabilitadas/ocultas com uma mensagem informativa.


4. Fluxo do Administrador (Requer Autenticação e Status de Admin)

O administrador utiliza um dashboard centralizado para monitorar a saúde do ecossistema e gerenciar o catálogo de produtos.
O status de administrador será gerenciado diretamente no firebase.

Login (Mesmo fluxo do lojista/consumidor)

Se o usuário é admin, a aplicação principal é o Dashboard Administrativo.

Dashboard Administrativo:
Visão Geral: Widgets exibem métricas chave como número de usuários ativos, ofertas criadas, novas lojas, e o volume de críticas de produtos pendentes.
Monitoramento de Preços: Gráficos interativos permitem ao administrador visualizar a média de preços de produtos específicos por região, identificando tendências e anomalias.
Monitoramento de Uso: Gráficos mostram a atividade do aplicativo, como volume de buscas, produtos mais procurados e engajamento dos usuários.

Gerenciamento de Críticas de Produtos:
Fila de Revisão: Uma interface exibe todos os produtos que receberam críticas dos usuários (ex: foto errada, descrição incorreta).
Ação de Correção: Para cada item na fila, o administrador pode visualizar a crítica, comparar com os dados atuais e corrigir a informação diretamente no produto canônico. A alteração é propagada para todas as ofertas vinculadas.

Gestão de Produtos Cadastrados (Canônicos):
O objetivo é ter um catálogo de produtos rico e preciso para que o lojista apenas precifique suas ofertas, sem precisar cadastrar detalhes.
O administrador pode buscar, filtrar, editar, e criar novos produtos canônicos.
O formulário de produto canônico inclui nome, descrição detalhada, categoria, código de barras e uma foto de alta qualidade.
O sistema também pode ter sugestões de novos produtos canônicos baseados em buscas de usuários que não retornaram resultados.